<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intel ‚Äì Team Sustainability Summit Check-In</title>
  <link rel="icon" href="img/intel-logo.png" />
  <meta name="theme-color" content="#2563eb" />
  <meta name="description" content="Check-in system for Intel's Team Sustainability Summit: greeting, team tracking, progress bar, and persistence." />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Hero -->
  <header class="hero" role="banner">
    <div class="hero__content">
      <img src="img/intel-logo.png" alt="Intel" class="hero__logo" />
      <h1 class="hero__title">Team Sustainability Summit</h1>
      <p class="hero__subtitle">Check-in system for sustainability event attendees</p>
    </div>
  </header>

  <main id="app" class="container" aria-live="polite">
    <!-- Attendance & Goal -->
    <section class="panel panel--compact" aria-labelledby="attGoal">
      <h2 id="attGoal" class="panel__title">Attendance and Goal</h2>
      <div class="totals">
        <div class="totals__label">
          <span aria-hidden="true">üë•</span> Attendance:
          <strong id="totalCount">0</strong> <span class="totals__of">/</span>
          <span id="goalValue">50</span>
        </div>
        <div class="totals__goal">
          Goal:
          <input id="goalInput" type="number" min="1" value="50" aria-label="Attendance goal" />
        </div>
      </div>
      <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Progress toward attendance goal">
        <div id="progressBar" class="progress__bar" style="width:0%;">0%</div>
      </div>
    </section>

    <!-- Greeting -->
    <section class="panel panel--message" aria-live="polite" aria-atomic="true" aria-labelledby="greetTitle">
      <h2 id="greetTitle" class="sr-only">Greeting</h2>
      <p id="greeting" class="greeting">Welcome! Check in to get started.</p>
    </section>

    <!-- Check-In Form -->
    <section class="panel" aria-labelledby="checkinTitle">
      <h2 id="checkinTitle" class="panel__title">Attendee Check-In</h2>
      <form id="checkInForm" class="form" autocomplete="off" novalidate>
        <div class="form__row">
          <label class="sr-only" for="nameInput">Enter name</label>
          <input id="nameInput" class="input" type="text" placeholder="Enter name‚Ä¶" required />

          <label class="sr-only" for="teamSelect">Select team</label>
          <select id="teamSelect" class="select" required>
            <option value="" disabled selected>Select Team‚Ä¶</option>
            <option>WaterWise</option>
            <option>Net Zero</option>
            <option>Renewables</option>
          </select>

          <button type="submit" class="btn btn-primary">
            <span aria-hidden="true">‚úÖ</span> Check In
          </button>
        </div>
        <div class="form__tools">
          <button id="undoBtn" type="button" class="btn btn-secondary" disabled>Undo Last</button>
          <button id="resetBtn" type="button" class="btn btn-danger">Reset All</button>
        </div>
      </form>
    </section>

    <!-- Team Tracking -->
    <section class="panel" aria-labelledby="teamTitle">
      <h2 id="teamTitle" class="panel__title">Team Attendance</h2>
      <div id="teamCards" class="teams"><!-- filled by JS --></div>
    </section>

    <!-- Attendee List -->
    <section class="panel" aria-labelledby="listTitle">
      <h2 id="listTitle" class="panel__title">Attendees</h2>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Team</th>
              <th scope="col">Time</th>
            </tr>
          </thead>
          <tbody id="attendeeBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Celebration Overlay -->
  <div id="celebrate" class="celebrate" role="dialog" aria-modal="true" aria-labelledby="celebrateTitle" hidden>
    <div class="celebrate__card">
      <h2 id="celebrateTitle">üéâ Goal Reached!</h2>
      <p id="winnerMsg" class="celebrate__msg"></p>
      <button id="closeCelebrate" class="btn btn-light">Continue</button>
    </div>
  </div>

  <footer class="footer">
    <p>&copy; <span id="year"></span> Intel (student project).</p>
  </footer>

  <!-- App Script -->
  <script>
    // ===== Intel Summit Check-In (meets rubric + level-ups) =====

    const STORAGE_KEY = 'intel-summit-checkin-v1';

    // Base state
    const initialState = {
      goal: 50,
      teams: ['WaterWise', 'Net Zero', 'Renewables'],
      teamCounts: { 'WaterWise': 0, 'Net Zero': 0, 'Renewables': 0 },
      attendees: [] // { name, team, ts }
    };
    const state = loadState() || structuredClone(initialState);

    // Elements
    const yearEl        = document.getElementById('year');
    const totalCountEl  = document.getElementById('totalCount');
    const goalValueEl   = document.getElementById('goalValue');
    const goalInputEl   = document.getElementById('goalInput');
    const progressBarEl = document.getElementById('progressBar');
    const greetingEl    = document.getElementById('greeting');

    const formEl        = document.getElementById('checkInForm');
    const nameEl        = document.getElementById('nameInput');
    const teamEl        = document.getElementById('teamSelect');
    const undoBtn       = document.getElementById('undoBtn');
    const resetBtn      = document.getElementById('resetBtn');

    const teamCardsEl   = document.getElementById('teamCards');
    const attendeeBody  = document.getElementById('attendeeBody');

    const celebrateEl   = document.getElementById('celebrate');
    const winnerMsgEl   = document.getElementById('winnerMsg');
    const closeCelebBtn = document.getElementById('closeCelebrate');

    // Init
    yearEl.textContent = new Date().getFullYear();
    goalInputEl.value = state.goal;
    goalValueEl.textContent = state.goal;
    renderAll();
    maybeCelebrate(); // if loaded state already met goal

    // Events
    formEl.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = (nameEl.value || '').trim();
      const team = teamEl.value;

      if (!name || !team) {
        setGreeting('Please enter a name and select a team.');
        return;
      }

      const entry = { name, team, ts: Date.now() };
      state.attendees.push(entry);
      state.teamCounts[team] = (state.teamCounts[team] || 0) + 1;

      setGreeting(`üéâ Welcome, ${sanitize(name)} from Team ${team}!`, true);
      saveState();
      renderAll();
      maybeCelebrate();

      formEl.reset();
      nameEl.focus();
    });

    goalInputEl.addEventListener('change', () => {
      const v = parseInt(goalInputEl.value, 10);
      state.goal = Number.isFinite(v) && v > 0 ? v : 1;
      saveState();
      goalValueEl.textContent = state.goal;
      renderProgress();
      maybeCelebrate();
    });

    undoBtn.addEventListener('click', () => {
      const last = state.attendees.pop();
      if (!last) return;
      state.teamCounts[last.team] = Math.max(0, (state.teamCounts[last.team] || 0) - 1);
      saveState();
      setGreeting(`Undid last check-in: ${sanitize(last.name)} (${last.team}).`);
      renderAll();
    });

    resetBtn.addEventListener('click', () => {
      if (!confirm('Reset all check-in data?')) return;
      Object.keys(state.teamCounts).forEach(t => state.teamCounts[t] = 0);
      state.attendees = [];
      saveState();
      hideCelebrate();
      setGreeting('All data cleared. Ready for fresh check-ins!');
      renderAll();
    });

    closeCelebBtn.addEventListener('click', hideCelebrate);

    // Renderers
    function renderAll() {
      renderTotals();
      renderTeams();
      renderList();
      renderProgress();
      undoBtn.disabled = state.attendees.length === 0;
    }

    function renderTotals() {
      totalCountEl.textContent = state.attendees.length;
    }

    function renderTeams() {
      const leader = winnerTeam();
      teamCardsEl.innerHTML = state.teams.map(t => {
        const count = state.teamCounts[t] || 0;
        const winClass = leader && leader.name === t ? ' team--winner' : '';
        const icon = t === 'WaterWise' ? 'üöø' : (t === 'Net Zero' ? 'üåø' : '‚ö°Ô∏è');
        return `
          <article class="team${winClass}" aria-label="${t} team count">
            <div class="team__icon" aria-hidden="true">${icon}</div>
            <h3>${t}</h3>
            <span class="count">${count}</span>
          </article>
        `;
      }).join('');
    }

    function renderList() {
      const rows = state.attendees.slice(-250).reverse().map(a => {
        const time = new Date(a.ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        return `<tr>
          <td>${sanitize(a.name)}</td>
          <td>${a.team}</td>
          <td>${time}</td>
        </tr>`;
      }).join('');
      attendeeBody.innerHTML = rows;
    }

    function renderProgress() {
      const total = state.attendees.length;
      const pct = Math.min(100, Math.round((total / Math.max(1, state.goal)) * 100));
      progressBarEl.style.width = pct + '%';
      progressBarEl.textContent = pct + '%';
      progressBarEl.parentElement.setAttribute('aria-valuenow', String(pct));
    }

    // Celebration (LevelUp)
    function winnerTeam() {
      const scores = state.teams.map(name => ({ name, count: state.teamCounts[name] || 0 }))
                                .sort((a, b) => b.count - a.count);
      if (!scores.length || scores[0].count === 0) return null;
      if (scores[1] && scores[1].count === scores[0].count) return null; // tie
      return scores[0];
    }

    function maybeCelebrate() {
      if (state.attendees.length >= state.goal) {
        const win = winnerTeam();
        winnerMsgEl.textContent = win
          ? `${win.name} is in the lead with ${win.count} check-ins!`
          : 'Attendance goal reached!';
        celebrateEl.hidden = false;
        celebrateEl.classList.add('active');
        confettiBurst();
      }
    }

    function hideCelebrate() {
      celebrateEl.classList.remove('active');
      celebrateEl.hidden = true;
      document.querySelectorAll('.confetti').forEach(n => n.remove());
    }

    // tiny confetti
    function confettiBurst() {
      const colors = ['#00bcd4','#0071c5','#8fe6ff','#28c76f','#ffd166'];
      for (let i = 0; i < 80; i++) {
        const d = document.createElement('div');
        d.className = 'confetti';
        const size = Math.random() * 8 + 6;
        Object.assign(d.style, {
          width: size + 'px',
          height: size + 'px',
          background: colors[(Math.random() * colors.length) | 0],
          left: (50 + (Math.random() * 40 - 20)) + '%',
          top: '45%',
          opacity: '0.9',
          position: 'fixed',
          borderRadius: '2px',
          pointerEvents: 'none',
          zIndex: 1001
        });
        document.body.appendChild(d);
        const x = Math.random() * 200 - 100;
        const y = 120 + Math.random() * 200;
        const r = Math.random() * 720 - 360;
        d.animate(
          [{ transform: 'translate(0,0) rotate(0deg)' },
           { transform: `translate(${x}px, ${y}px) rotate(${r}deg)` }],
          { duration: 900 + Math.random() * 900, easing: 'cubic-bezier(.2,.6,.2,1)', fill: 'forwards' }
        ).onfinish = () => d.remove();
      }
    }

    // Utils
    function setGreeting(text, pulse = false) {
      greetingEl.textContent = text;
      if (pulse) {
        greetingEl.classList.add('greet-pulse');
        setTimeout(() => greetingEl.classList.remove('greet-pulse'), 450);
      }
    }
    function saveState() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function loadState() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null'); } catch { return null; } }
    function sanitize(s) { return (s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  </script>
</body>
</html>
